unit UMapView;interface	uses		UGoof, ULevel, UMapParams,{}		UMapBlocks, UMapObjects, UMapBSPTree, UMapGrid;	type		TMapView = object(TView)				fLevel: LevelHandle;				procedure IMapView (level: LevelHandle);				procedure Draw;				override;			end;implementation	procedure TMapView.IMapView (level: LevelHandle);		var			r: Rect;	begin		SetRect(r, 0, 0, margin + 64 * cellSize, margin + 64 * cellSize);		IView(nil, nil, r);		fLevel := level;	end;	procedure TMapView.Draw;		var			vis: Rect;			minRow, maxRow, minCol, maxCol: integer;		procedure DrawLayers (layers: MapLayers);		begin			MapBlocks(fLevel, layers, minRow, maxRow, minCol, maxCol);			MapObjects(fLevel, layers, minRow, maxRow, minCol, maxCol);			MapBSPTree(fLevel, layers, vis);			MapGrid(fLevel, layers, vis);		end;	begin		vis := thePort^.visRgn^^.rgnBBox;		minRow := (vis.top - margin) div cellSize;		maxRow := (vis.bottom - margin) div cellSize;		minCol := (vis.left - margin) div cellSize;		maxCol := (vis.right - margin) div cellSize;		TextSize(9);		DrawLayers([blockLayer]);		DrawLayers([gridLayer]);		DrawLayers([splitLayer]);		DrawLayers([segLayer]);		DrawLayers([blockCodeLayer]);		DrawLayers([objCodeLayer]);		DrawLayers([segCodeLayer]);	end;end.